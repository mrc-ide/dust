#!/usr/bin/env Rscript
glue_whisker <- function(template, data) {
  glue::glue_data(data, template, .open = "{{", .close = "}}",
                  .trim = FALSE)
}

version <- numeric_version(read.dcf("DESCRIPTION", "Version")[[1]])

major <- version[[1, 1]]
minor <- version[[1, 2]]
patch <- version[[1, 3]]

data <- list(
  header = "// Generated by scripts/update_version - do not edit",
  major = major,
  minor = minor,
  patch = patch,
  code = major * 10000 + minor * 100 + patch,
  string = as.character(version))

root <- here::here()
dest <- file.path(root, "inst/include/dust/random/version.hpp")
template <- paste(
  readLines(file.path(root, "inst/template/version.hpp")),
  collapse = "\n")
writeLines(glue_whisker(template, data), dest)
