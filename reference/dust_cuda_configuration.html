<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Detect CUDA configuration — dust_cuda_configuration • dust</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Detect CUDA configuration — dust_cuda_configuration"><meta property="og:description" content="Detect CUDA configuration. This function tries to compile a small
program with nvcc and confirms that this can be loaded into R,
then uses that program to query the presence and capabilities of
your NVIDIA GPUs. If this works, then you can use the GPU-enabled
dust features, and the information returned will help us.  It's
quite slow to execute (several seconds) so we cache the value
within a session.  Later versions of dust will cache this across
sessions too."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dust</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.15.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/dust.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/design.html">Principles and design of dust</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Random numbers</li>
    <li>
      <a href="../articles/rng.html">Random number generation</a>
    </li>
    <li>
      <a href="../articles/rng_algorithms.html">Algorithms used to compute random numbers</a>
    </li>
    <li>
      <a href="../articles/rng_package.html">Using RNGs from packages</a>
    </li>
    <li>
      <a href="../articles/rng_distributed.html">Distributed parallel random numbers</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Dive deeper</li>
    <li>
      <a href="../articles/data.html">Comparing models and data</a>
    </li>
    <li>
      <a href="../articles/gpu.html">Running models on GPUs with CUDA</a>
    </li>
    <li>
      <a href="../articles/multi.html">Multiple parameter sets</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mrc-ide/dust/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Detect CUDA configuration</h1>
    <small class="dont-index">Source: <a href="https://github.com/mrc-ide/dust/blob/master/R/cuda.R" class="external-link"><code>R/cuda.R</code></a></small>
    <div class="hidden name"><code>dust_cuda_configuration.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Detect CUDA configuration. This function tries to compile a small
program with <code>nvcc</code> and confirms that this can be loaded into R,
then uses that program to query the presence and capabilities of
your NVIDIA GPUs. If this works, then you can use the GPU-enabled
dust features, and the information returned will help us.  It's
quite slow to execute (several seconds) so we cache the value
within a session.  Later versions of dust will cache this across
sessions too.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dust_cuda_configuration</span><span class="op">(</span></span>
<span>  path_cuda_lib <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  path_cub_include <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  forget <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-path-cuda-lib">path_cuda_lib<a class="anchor" aria-label="anchor" href="#arg-path-cuda-lib"></a></dt>
<dd><p>Optional path to the CUDA libraries, if they
are not on system library paths. This will be added as
<code>-L{path_cuda_lib}</code> in calls to <code>nvcc</code></p></dd>


<dt id="arg-path-cub-include">path_cub_include<a class="anchor" aria-label="anchor" href="#arg-path-cub-include"></a></dt>
<dd><p>Optional path to the CUB headers, if using
CUDA &lt; 11.0.0. See Details</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical, indicating if compilation of test programs
should be quiet</p></dd>


<dt id="arg-forget">forget<a class="anchor" aria-label="anchor" href="#arg-forget"></a></dt>
<dd><p>Logical, indicating if we should forget cached
values and recompute the configuration</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list of configuration information. This includes:</p><ul><li><p><code>has_cuda</code>: logical, indicating if it is possible to compile CUDA on
this machine (not necessarily use it though)</p></li>
<li><p><code>cuda_version</code>: the version of CUDA found</p></li>
<li><p><code>devices</code>: a data.frame of device information:</p><ul><li><p>id: the device id (integer, typically in a sequence from 0)</p></li>
<li><p>name: the human-friendly name of the device</p></li>
<li><p>memory: the memory of the device, in MB</p></li>
<li><p>version: the compute version for this device</p></li>
</ul></li>
<li><p><code>path_cuda_lib</code>: path to CUDA libraries, if required</p></li>
<li><p><code>path_cub_include</code>: path to CUB headers, if required</p></li>
</ul><p>If compilation of the test program fails, then <code>has_cuda</code> will be
<code>FALSE</code> and all other elements will be <code>NULL</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Not all installations leave the CUDA libraries on the default
paths, and you may need to provide it. Specifically, when we link
the dynamic library, if the linker complains about not being able
to find <code>libcudart</code> then your CUDA libraries are not in the
default location. You can manually pass in the <code>path_cuda_lib</code>
argument, or set the <code>DUST_PATH_CUDA_LIB</code> environment variable (in
that order of precedence).</p>
<p>If you are using older CUDA (&lt; 11.0.0) then you need to provide
<a href="https://nvlabs.github.io/cub/" class="external-link">CUB</a> headers, which we use to
manage state on the device (these are included in CUDA 11.0.0 and
higher). You can provide this as:</p><ul><li><p>a path to this function (<code>path_cub_include</code>)</p></li>
<li><p>the environment variable DUST_PATH_CUB_INCLUDE</p></li>
<li><p>CUB headers installed into the default location (R &gt;= 4.0.0,
see below).</p></li>
</ul><p>These are checked in turn with the first found taking
precedence. The default location is stored with
<code>tools::R_user_dir("dust", "data")</code>, but this functionality is
only available on R &gt;= 4.0.0.</p>
<p>To install CUB you can do:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>dust<span class="sc">:::</span><span class="fu">cuda_install_cub</span>(<span class="cn">NULL</span>)</span></code></pre><p></p></div>
<p>which will install CUB into the default path (provide a path on
older versions of R and set this path as DUST_PATH_CUB_INCLUDE).</p>
<p>For editing your .Renviron file to set these environment
variables, <code>usethis::edit_r_environ()</code> is very helpful.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="dust_cuda_options.html">dust_cuda_options</a> which controls additional CUDA
compilation options (e.g., profiling, debug mode or custom
flags)</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># If you have your CUDA library in an unusual location, then you</span></span></span>
<span class="r-in"><span><span class="co"># may need to add a path_cuda_lib argument:</span></span></span>
<span class="r-in"><span><span class="fu">dust</span><span class="fu">::</span><span class="fu">dust_cuda_configuration</span><span class="op">(</span></span></span>
<span class="r-in"><span>  path_cuda_lib <span class="op">=</span> <span class="st">"/usr/local/cuda-11.1/lib64"</span>,</span></span>
<span class="r-in"><span>  forget <span class="op">=</span> <span class="cn">TRUE</span>, quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> nvcc detection reported failure:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Did not find 'libcudart' within '/usr/local/cuda-11.1/lib64' (via provided argument)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $has_cuda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cuda_version</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $devices</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $path_cuda_lib</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $path_cub_include</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># However, if things are installed in the default location or you</span></span></span>
<span class="r-in"><span><span class="co"># have set the environment variables described above, then this</span></span></span>
<span class="r-in"><span><span class="co"># may work:</span></span></span>
<span class="r-in"><span><span class="fu">dust</span><span class="fu">::</span><span class="fu">dust_cuda_configuration</span><span class="op">(</span>forget <span class="op">=</span> <span class="cn">TRUE</span>, quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">dustf4585e9f</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> 1 functions decorated with [[cpp11::register]]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> generated file <span style="color: #0000BB;">cpp11.R</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> generated file <span style="color: #0000BB;">cpp11.cpp</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Re-compiling <span style="color: #0000BB;">dustf4585e9f</span> (debug build)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="color: #00BBBB;">R CMD INSTALL</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * installing *source* package ‘dustf4585e9f’ ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ** this is package ‘dustf4585e9f’ version ‘0.0.1’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ** using staged installation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ** libs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> using C++ compiler: ‘g++ (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> using C++14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> g++ -std=gnu++14 -I"/opt/R/4.5.1/lib/R/include" -DNDEBUG  -I'/home/runner/work/_temp/Library/cpp11/include' -I/usr/local/include   -I/home/runner/work/_temp/Library/dust/include -DHAVE_INLINE -fopenmp  -fpic  -g -O2  -UNDEBUG -Wall -pedantic -g -O0 -fdiagnostics-color=always  -c cpp11.cpp -o cpp11.o</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nvcc -std=c++14 -O0 -I. -I/opt/R/4.5.1/lib/R/include -I/home/runner/work/_temp/Library/dust/include  -I'/home/runner/work/_temp/Library/cpp11/include'  -Xcompiler -fPIC -Xcompiler -fopenmp -x cu -c dust.cu -o dust.o</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> /bin/bash: line 1: nvcc: command not found</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> make: *** [Makevars:14: dust.o] Error 127</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ERROR: compilation failed for package ‘dustf4585e9f’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * removing ‘/tmp/RtmprAiVJB/devtools_install_21d7406c8a7b/dustf4585e9f’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> nvcc detection reported failure:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> System command 'R' failed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $has_cuda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cuda_version</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $devices</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $path_cuda_lib</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $path_cub_include</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rich FitzJohn, Alex Hill, John Lees.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

