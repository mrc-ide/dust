<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multiple parameter sets • dust</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multiple parameter sets">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dust</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.15.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/dust.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/design.html">Principles and design of dust</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Random numbers</li>
    <li>
      <a href="../articles/rng.html">Random number generation</a>
    </li>
    <li>
      <a href="../articles/rng_algorithms.html">Algorithms used to compute random numbers</a>
    </li>
    <li>
      <a href="../articles/rng_package.html">Using RNGs from packages</a>
    </li>
    <li>
      <a href="../articles/rng_distributed.html">Distributed parallel random numbers</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Dive deeper</li>
    <li>
      <a href="../articles/data.html">Comparing models and data</a>
    </li>
    <li>
      <a href="../articles/gpu.html">Running models on GPUs with CUDA</a>
    </li>
    <li>
      <a href="../articles/multi.html">Multiple parameter sets</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/dust/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multiple parameter sets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/dust/blob/master/vignettes/multi.Rmd" class="external-link"><code>vignettes/multi.Rmd</code></a></small>
      <div class="hidden name"><code>multi.Rmd</code></div>

    </div>

    
    
<p>dust provides support for simulating lots of particles at once.
Sometimes that will be with a single parameter set and many traces to
capture stochastic variability, but other times different particles will
need different parameter sets too.</p>
<p>To allow this, dust supports creating a model and indicating that the
parameters represents some group of parameter sets. Consider our SIR
example from <code><a href="../articles/dust.html">vignette("dust")</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir</span> <span class="op">&lt;-</span> <span class="fu">dust</span><span class="fu">::</span><span class="fu"><a href="../reference/dust_example.html">dust_example</a></span><span class="op">(</span><span class="st">"sir"</span><span class="op">)</span></span></code></pre></div>
<p>For one parameter set with 8 particles we might do:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">pars</span>, <span class="fl">0</span>, <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p>The “shape” of this model is most easily seen in the state:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span><span class="co">#&gt; [1,] 1000 1000 1000 1000 1000 1000 1000 1000</span></span>
<span><span class="co">#&gt; [2,]   10   10   10   10   10   10   10   10</span></span>
<span><span class="co">#&gt; [3,]    0    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; [4,]    0    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; [5,]    0    0    0    0    0    0    0    0</span></span></code></pre></div>
<p>So here we have 5 state variables and 8 particles. The number of
state variables is a property of the model, while the number of
particles is a property of how you have configured the model, and we
will call that the “shape”</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="fu">shape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span></code></pre></div>
<p>There are also two helper methods which report the number of
particles and number of particles per parameter set, here these will
both report 8:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="fu">n_particles</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">n_particles_each</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span></code></pre></div>
<p>So far so easy.</p>
<p>Suppose we have 2 regions (or other grouping) that we want to
simulate at once and these have different parameter sets. We create an
<em>unnamed list</em> containing the parameter sets</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0.1</span>, I0 <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0.2</span>, I0 <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>and then when creating the model we indicate that we want 4 particles
each for our 2 parameter sets. The total number of particles will be 4 *
2 = 8</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">pars</span>, <span class="fl">0</span>, <span class="fl">4</span>, pars_multi <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The state has a different shape now:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,] 1000 1000 1000 1000</span></span>
<span><span class="co">#&gt; [2,]   10   10   10   10</span></span>
<span><span class="co">#&gt; [3,]    0    0    0    0</span></span>
<span><span class="co">#&gt; [4,]    0    0    0    0</span></span>
<span><span class="co">#&gt; [5,]    0    0    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,] 1000 1000 1000 1000</span></span>
<span><span class="co">#&gt; [2,]   12   12   12   12</span></span>
<span><span class="co">#&gt; [3,]    0    0    0    0</span></span>
<span><span class="co">#&gt; [4,]    0    0    0    0</span></span>
<span><span class="co">#&gt; [5,]    0    0    0    0</span></span></code></pre></div>
<p>It’s a 3-dimensional array with dimensions 5, 4, 2 corresponding to
the number of state elements, number of replicates per parameter set and
the number of parameter sets. Note that the second parameter set’s state
is different because the <code>I0</code> parameter specifies the number
of infected individuals in the initial conditions.</p>
<p>The “shape” of the data here is <code>c(4, 2)</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="fu">shape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4 2</span></span></code></pre></div>
<p>We still have 8 particles, but 4 per parameter set:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="fu">n_particles</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">n_particles_each</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p>This sort of shape is useful where we want to fit multiple particle
filters to the data, or simulate replicates blocked across a common set
of parameters; that is we’re interested in exploring the stochastic
variation that occurs given a particular parameter set.</p>
<p>But there are other way of shaping the state that are useful.</p>
<p>Suppose that you have many parameter sets, each representing (say) an
estimate based on some inference process</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">0.05</span>, <span class="fl">0.3</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For this we might write:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">pars</span>, <span class="fl">0</span>, <span class="fl">1</span>, pars_multi <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>to indicate 1 particle per parameter. However, that’s not ideal:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5 1 8</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">shape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 8</span></span></code></pre></div>
<p>By doing this we end up with a weird dimension in the middle of our
state. This would make sense if we were going to also replicate within
the parameter set but does not make any sense this way.</p>
<p>To indicate that we don’t want this, pass <code>NULL</code> in for
the number of particles:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">pars</span>, <span class="fl">0</span>, <span class="cn">NULL</span>, pars_multi <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span><span class="co">#&gt; [1,] 1000 1000 1000 1000 1000 1000 1000 1000</span></span>
<span><span class="co">#&gt; [2,]   10   10   10   10   10   10   10   10</span></span>
<span><span class="co">#&gt; [3,]    0    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; [4,]    0    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; [5,]    0    0    0    0    0    0    0    0</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">shape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span></code></pre></div>
<p>(why <code>NULL</code>? because if you tried <code>c(5, 1, 8)</code>
and <code>c(5, NULL, 8)</code> you would see the same values as the two
state vectors above).</p>
<p>Further options are useful! Suppose in our previous case, the 8
parameter sets were themselves structured in some block, representing
two groups of four parameter sets. To indicate this we create a list
with dimensions:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">pars</span></span>
<span><span class="co">#&gt;      [,1]   [,2]  </span></span>
<span><span class="co">#&gt; [1,] list,1 list,1</span></span>
<span><span class="co">#&gt; [2,] list,1 list,1</span></span>
<span><span class="co">#&gt; [3,] list,1 list,1</span></span>
<span><span class="co">#&gt; [4,] list,1 list,1</span></span></code></pre></div>
<p>Then, when creating the object these dimensions will be applied to
the data</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">pars</span>, <span class="fl">0</span>, <span class="cn">NULL</span>, pars_multi <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,] 1000 1000 1000 1000</span></span>
<span><span class="co">#&gt; [2,]   10   10   10   10</span></span>
<span><span class="co">#&gt; [3,]    0    0    0    0</span></span>
<span><span class="co">#&gt; [4,]    0    0    0    0</span></span>
<span><span class="co">#&gt; [5,]    0    0    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,] 1000 1000 1000 1000</span></span>
<span><span class="co">#&gt; [2,]   10   10   10   10</span></span>
<span><span class="co">#&gt; [3,]    0    0    0    0</span></span>
<span><span class="co">#&gt; [4,]    0    0    0    0</span></span>
<span><span class="co">#&gt; [5,]    0    0    0    0</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">shape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4 2</span></span></code></pre></div>
<p>These options have implications for a number of methods, and for the
basic running of the simulation. For example, when we run our model with
structured parameters:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  5  4  2 11</span></span></code></pre></div>
<p>Here the simulation output has dimensions:</p>
<ul>
<li>5 - the number of state variables</li>
<li>4 - the first value of <code>mod$shape()</code>, as the first
dimension of the parameters</li>
<li>2 - the second value of <code>mod$shape()</code>, as the second
dimension of the parameters</li>
<li>11 - the number of timesteps recorded in the simulation</li>
</ul>
<p>Conversely if we’d <em>also</em> replicated parameters with this set
of parameters we might see</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">pars</span>, <span class="fl">0</span>, <span class="fl">3</span>, pars_multi <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">shape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3 4 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  5  3  4  2 11</span></span></code></pre></div>
<p>Again here note that <code>mod$shape()</code> is sandwiched between
the number of state variables and number of timesteps.</p>
<div class="section level2">
<h2 id="considerations">Considerations<a class="anchor" aria-label="anchor" href="#considerations"></a>
</h2>
<p>There are a few helpful things on single parameter objects that
become ambiguous or awkward with multi-parameter objects. Starting with
a single parameter object:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">sir</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">pars</span>, <span class="fl">0</span>, <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p>We might set all particles to have the same initial state:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span><span class="op">$</span><span class="fu">update_state</span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span><span class="co">#&gt; [1,] 1000 1000 1000 1000 1000 1000 1000 1000</span></span>
<span><span class="co">#&gt; [2,]   10   10   10   10   10   10   10   10</span></span>
<span><span class="co">#&gt; [3,]    0    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; [4,]    0    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; [5,]    0    0    0    0    0    0    0    0</span></span></code></pre></div>
<p>or we might set each particle to a different state, perhaps
representing some stochasticity in starting values</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">update_state</span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fl">1010</span> <span class="op">-</span> <span class="va">n</span>, <span class="va">n</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod</span><span class="op">$</span><span class="fu">state</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span><span class="co">#&gt; [1,] 1001  993  998 1003 1002 1008 1002 1000</span></span>
<span><span class="co">#&gt; [2,]    9   17   12    7    8    2    8   10</span></span>
<span><span class="co">#&gt; [3,]    0    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; [4,]    0    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; [5,]    0    0    0    0    0    0    0    0</span></span></code></pre></div>
<p>The difference here is the dimension of the new state. Recall that
the state will always be in the form</p>
<pre><code>n_state, shape[1], ..., shape[n]</code></pre>
<p>If the dimension lacks the <em>first</em> element of shape, and if
there is more than one particle per parameter set, then we replicate
state across all particles that share that parameter set.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rich FitzJohn, Alex Hill, John Lees.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
